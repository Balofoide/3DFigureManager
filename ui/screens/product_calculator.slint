import { Theme } from "../styling.slint";
import { Container, SideButton, InputField, OverviewCard, BaloButton, CustomComboBox, DataInput} from "../components.slint";
import {Button, ComboBox, LineEdit,VerticalBox, HorizontalBox, GridBox, ListView, ScrollView,DatePickerPopup} from "std-widgets.slint";

import { Database, Impressoras, Estoque-Database } from "../shared.slint";

export component calculator_screen {
    
    in-out property <string> filamento;
    in-out property <string> material;
    in-out property <string> tempo;
    in-out property <string> energia;
    in-out property <string> lucro;
    in-out property <float> total;
    in-out property <string> nome_cliente;
    in-out property <string> endereco;
    in-out property <string> cep;
    in-out property <string> telefone;
    in-out property <string> entrega;
    in-out property <[string]> impressoras_string;
    in-out property <string> combobox_selected;
    in-out property <[Database]> clients_database;
    in-out property <int> filamento_printer;
    in-out property <string> observacao;
    in-out property <string> modelo;
    in-out property <string> status;
    in-out property <Database> selected_client;
    in-out property <string> cpf;
    
    callback calcular_preco();
    callback registrar_cliente();
    callback resetar_inputs();
    callback atualizar_filamento();
    callback editar_cliente();
    callback excluir_cliente();
    callback atualizar_f_preco();

    callback estoque();
    callback impressoras();
    callback dashboard();
    callback configuracoes();
   

    // Variaveis de Edit
    in-out property <string> temp_nome_client;
    in-out property <string> temp_entrega;
    in-out property <string> temp_endereco;
    in-out property <string> temp_observacao;
    in-out property <string> temp_status;
    in-out property <string> temp_cep;
    in-out property <string> temp_telefone;
    in-out property <string> temp_cpf;


    width: 500px;
    height: 500px;
    Rectangle {
        width: parent.width;
        height: parent.height;
        background: Theme.background;
        visible: true;

        

        
        Pedidos := VerticalBox {
            HorizontalBox {
                
                GridBox {
                    HorizontalBox {
                         
                        // max-height: 50px;
                        Text {
                                text: "Pedidos";
                                color: Theme.onBackground;
                                font-weight: 800;
                                font-size: 40px;
                            }
        
                           
        
                            BaloButton {
                                visible: false;
                                width: 150px;
                                height: 50px;
                                texto: "Dashboard";
                                clicked => {dashboard() }
                            }
        
                            BaloButton {
                                visible: false;
                                width: 150px;
                                height: 50px;
                                texto: "Estoque";
                                clicked => {estoque() }
                            }
        
                            BaloButton {
                                visible: false;
                                width: 150px;
                                height: 50px;
                                texto: "Impressoras";
                                clicked => {impressoras() }
                            }
                           
                            BaloButton {
                                visible: false;
                                width: 150px;
                                height: 50px;
                                texto: "Configurações";
                                clicked => { configuracoes()}
                            }
                            BaloButton {
                                width: 150px;
                                height: 50px;
                                texto: "Adicionar Pedido";


                                background:!self.has-hover  ? Theme.primary : Theme.secondaryLight;
                                cor_texto: !self.has-hover ?  Theme.onPrimary :  Theme.onBackground;
                                 clicked => {Novo_Pedido.visible = true; Pedidos.visible=false;}


                                   
                            }
                        } 
                    Edit_Screen := PopupWindow{
                        width: parent.width;
                        height: parent.height;
                        close-policy: close-on-click-outside;
                        x: parent.width / 200;
                        y: parent.height *0.5;
                        VerticalLayout {
                            width: 600px;
                            height: 500px;
                             
                            Container {
                                cor: Theme.background;
                                width: 100%;
                                height: 100%;
                                shadow_blur: 10px;
                                border_width: 1px;
                                border_radius: 10px;
                                
                                VerticalBox {
                                    
                                    HorizontalBox {
                                        Text {
                                            vertical-alignment: center;
                                            text: "Editar Pedido";
                                            color: Theme.onBackground;
                                            font-weight: 800;
                                            font-size: 20px;
                                        }
                                        BaloButton { width:80px; height: 40px;texto: "Confirmar"; clicked => {editar_cliente(); Edit_Screen.close();}}
                                    }
                                    
                                     InputField {texto: "Cliente ";max_lenght: 20; input<=> temp_nome_client;}
                                             InputField {texto: "Telefone "; max_lenght: 30; input<=> temp_telefone;}                                  
                                             DataInput {texto: "Entrega "; input<=> temp_entrega ;}       
                                             InputField {texto: "Cep"; input<=> temp_cep;}   
                                            InputField {texto: "Observações: "; max_lenght: 50; input<=> temp_observacao;}
                                            InputField {texto: "Endereço: "; max_lenght: 50; input<=> temp_endereco;}
                                            InputField {texto: "Cpf: "; max_lenght: 50; input<=> temp_cpf;}
                                             
                                           
                                        
                                    
                                                   
                                   
                                    
                                }
                              
                            }
                        }
                        
                    }
                  
                     
                }
            }
            HorizontalBox {
                 
                GridBox {
              
 
                    Row {
                        Container {
                        
                            cor: Theme.surface;
                            VerticalBox {
                             
                                Rectangle {
                                       visible: false;
                                    background: Theme.surface;
                                    
                                    height: 60px;
                                    InputField {
                                        
                                        width: 80%;
                                        height: parent.height;
                                        place_holder: "Pesquisar";
                                         
                                    }
                                    
                                }
                            spacing: Theme.spacing;
                                HorizontalBox {
                                    // spacing: Theme.spacing;
                                    Text {
                                            text: "Nome";
                                            color: Theme.onSurface;
                                            font-weight: 700;
                                            horizontal-alignment: center;
                                        }
    
                                        Text {
                                            text: "Data de Entrega";
                                            color: Theme.onSurface;
                                            font-weight: 700;
                                            horizontal-alignment: center;
                                        }
    
                                        Text {
                                            text: "Status";
                                            color: Theme.onSurface;
                                            font-weight: 700;
                                            horizontal-alignment: center;
                                        }
    
                                        Text {
                                            text: "Preço";
                                            color: Theme.onSurface;
                                            font-weight: 700;
                                            horizontal-alignment: center;
                                        }
                                    }
                                }
    
                                Rectangle {
                                    ListView {
                                        height: 60%;
                                        for client[index] in clients_database: TouchArea {
                                            clicked => {
                                                
                                                root.selected_client = root.clients_database[index];
                                                Detalhes_Pedido.visible = true;
                                                Pedido_Status.current-value = selected_client.status;
                                                 
                                            }
                                             property <bool> selected_hover <=> self.has-hover;
 
                                            
                                            // spacing: Theme.spacing;
                                            // padding: Theme.spacing;
                                           fundo_client := Rectangle {
                                                width: 98%;
                                                height: 90%;
                                                padding: 8px;
                                                // border-radius: 5px;
                                                // drop-shadow-offset-y: 1px;  
                                                background: !selected_hover && selected_client.id != client.id? Theme.background:Theme.secondaryLight;

                                                


                                                HorizontalBox {
                                                    alignment: center;
                                                    Rectangle {
                                                        width: 25%;
                                                        Text {
                                                            text: client.nome;
                                                            color: Theme.onSurface;
                                                            horizontal-alignment: center;
                                                            overflow: elide;
                                                        }
                                                    }
    
                                                    Rectangle {
                                                        width: 25%;
                                                        Text {
                                                            text: client.entrega;
                                                            color: Theme.onSurface;
                                                            horizontal-alignment: center;
                                                        }
                                                    }
    
                                                    Rectangle {
                                                        width: 25%;
                                                        Text {
                                                            text: client.status;
                                                            color: Theme.onSurface;
                                                            horizontal-alignment: center;
                                                        }
                                                    }
    
                                                    Rectangle {
                                                        width: 25%;
                                                        Text {
                                                            text: "R$" + client.preco.to-fixed(2);
                                                            color: Theme.onSurface;
                                                            horizontal-alignment: center;
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                            }
                        }
    
                        Container {
                            width: 40%;
                            cor: Theme.surface;
                            VerticalBox {
                                VerticalBox {
                                      Confirm_screen := PopupWindow{
                                        width: parent.width;
                                        height: parent.height;
                                        close-policy: close-on-click-outside;
                                        x: parent.width / 200;
                                        y: parent.height *3;
                                        VerticalLayout {
                                            
                                            
                                            Container {
                                                cor: Theme.background;
                                                width: 100%;
                                                height: 100%;
                                                shadow_blur: 10px;
                                                border_width: 1px;
                                                border_radius: 10px;
                                                
                                                VerticalBox {
                                                    HorizontalBox {
                                                        Text {
                                                        
                                                            text: "Confirmação";
                                                            color: Theme.onBackground;
                                                            font-weight: 800;
                                                            font-size: 20px;
                                                        }
                                                    
                                                    }
                                                    HorizontalBox {
                                                        
                                                    Text {
                                                        
                                                            text: "Deseja excluir o pedido de "+selected_client.nome+" ?";
                                                            color: Theme.onBackground;
                                                            font-weight: 800;
                                                            font-size: Theme.fontSizeBody;
                                                        }
                                                    }
                                                    
                                                    HorizontalBox {
                                                        spacing: Theme.spacing;
                                                        BaloButton { width:80px; height: 40px;texto: "Cancelar"; clicked => {Confirm_screen.close()}}
                                                        BaloButton { width:80px; height: 40px;texto: "Confirmar"; clicked => {excluir_cliente(); Confirm_screen.close();Detalhes_Pedido.visible=false}}
                                                    }
                                                    
                
                                                }
                                            
                                            }
                                        }
                        
                                    }
                                    HorizontalLayout {
                                        Text {
                                            vertical-alignment: center;
                                            text: "Detalhes de Pedido";
                                            color: Theme.onSurface;
                                            font-size: Theme.fontSizeTitle;
                                            font-weight: 700;
                                        }
    
                                        HorizontalLayout {
                                            visible: !selected_client.id.is-empty;
                                            spacing: 10px;
                                            alignment: center;
                                            width: 3%;
                                            BaloButton {height: 30px; width: 50px; texto: "Editar"; clicked => {Edit_Screen.show();
                                                temp_nome_client = selected_client.nome;
                                                temp_entrega = selected_client.entrega;
                                                temp_observacao = selected_client.observacao;
                                                temp_endereco = selected_client.endereco;                 
                                                temp_cep = selected_client.cep;
                                                temp_telefone = selected_client.telefone;     
                                                temp_cpf = selected_client.cpf;                    
                                            }}
                                            BaloButton {background:#f01414;height: 30px; width: 50px; texto: "🗑️"; clicked => {Confirm_screen.show()}}
                                        }
                                        
                                    }
                                    
                                }
    
                                HorizontalBox {
                                    
                                    spacing: Theme.spacing;
                                    Detalhes_Pedido := VerticalBox {
                                        visible: selected_client.preco != 0;
                                        spacing: Theme.spacing;
                                        Container {
                                            cor: Theme.background;
                                            height: 100px;
                                            
                                            GridBox {
                                                
                                                Row {
                                                    VerticalBox {
                                                        alignment: center;
                                                        Text {
                                                            horizontal-alignment: center;
                                                            text: "Cliente";
                                                            color: Theme.onBackground;
                                                            font-size: Theme.fontSizeBody;
                                                            font-weight: 700;
                                                        }
    
                                                        Text {
                                                            horizontal-alignment: center;
                                                            text: "\{root.selected_client.nome}";
                                                            color: Theme.onBackground;
                                                            font-size: Theme.fontSizeBody;
                                                            font-weight: 500;
                                                        }
                                                    }
    
                                                    VerticalBox {
                                                        alignment: center;
                                                        Text {
                                                            horizontal-alignment: center;
                                                            text: "Telefone";
                                                            color: Theme.onBackground;
                                                            font-size: Theme.fontSizeBody;
                                                            font-weight: 700;
                                                        }
    
                                                        Text {
                                                            horizontal-alignment: center;
                                                            text: "\{root.selected_client.telefone}";
                                                            color: Theme.onBackground;
                                                            font-size: Theme.fontSizeBody;
                                                            font-weight: 500;
                                                        }
                                                        
                                                    }
                                                     VerticalBox {
                                                        alignment: center;
                                                        Text {
                                                            horizontal-alignment: center;
                                                            text: "Cpf";
                                                            color: Theme.onBackground;
                                                            font-size: Theme.fontSizeBody;
                                                            font-weight: 700;
                                                        }
    
                                                        Text {
                                                            horizontal-alignment: center;
                                                            text: "\{root.selected_client.cpf}";
                                                            color: Theme.onBackground;
                                                            font-size: Theme.fontSizeBody;
                                                            font-weight: 500;
                                                        }
                                                    }

                                                   
                                                }
                                               
                                            }
                                             
                                        }
                                        
                                        
                                        Container {
                                            cor: Theme.background;
                                            HorizontalBox {
                                                alignment: center;
                                                VerticalBox {
                                                    alignment: center;
                                                    Text {
                                                    horizontal-alignment: center;
                                                    text: "Modelo";
                                                    color: Theme.onBackground;
                                                    font-size: Theme.fontSizeBody;
                                                    font-weight: 700;
                                                }
    
                                                Text {
                                                    horizontal-alignment: center;
                                                    text: "\{root.selected_client.modelo}";
                                                    color: Theme.onBackground;
                                                    font-size: Theme.fontSizeBody;
                                                    font-weight: 500;
                                                }
                                                }

                                                 VerticalBox {
                                                    alignment: center;
                                                    Text {
                                                    horizontal-alignment: center;
                                                    text: "Filamento Gasto";
                                                    color: Theme.onBackground;
                                                    font-size: Theme.fontSizeBody;
                                                    font-weight: 700;
                                                }
    
                                                Text {
                                                    horizontal-alignment: center;
                                                    text: "\{root.selected_client.filamento_gasto}g";
                                                    color: Theme.onBackground;
                                                    font-size: Theme.fontSizeBody;
                                                    font-weight: 500;
                                                }
                                                }
                                            }
                                        }
    
                                        Container {
                                            
                                            cor: Theme.background;
                                            VerticalBox {

                                            
                                                HorizontalLayout {
                                                    spacing: Theme.spacing;
                                                    alignment: center;
                                                    VerticalLayout {
                                                        
                                                    
                                                        Text {
                                                            horizontal-alignment: center;
                                                            text: "Status";
                                                            color: Theme.onBackground;
                                                            font-size: Theme.fontSizeBody;
                                                            font-weight: 700;
                                                        }
                                                        
                                                    
                                                            
                                                        
                                                    Pedido_Status := CustomComboBox {
                                                            // texto: "Status";
                                                            
                                                            //  width: 50%;
                                                            model: ["Pendente","Trabalhando","Concluido","Entregue"];
                                                            current-value: root.selected_client.status;
                                                            
                                                            selected(current-value) => {
                                                                temp_status = current-value;
                                                                editar_cliente();
                                                                
                                                            }
                                                            
                                                    

                                                        

                                                            }
                                                                
                                                
                                                        
                                                        
                                                        // Text {
                                                        //     horizontal-alignment: center;
                                                        //     text: "\{root.selected_client.status}";
                                                        //     color: black;
                                                        //     font-size: Theme.fontSizeBody;
                                                        //     font-weight: 500;
                                                        // }
                                                    }
                                            }
                                        }
                                        }
    
                                        Container {
                                            cor: Theme.background;
                                            VerticalBox {
                                                alignment: center;
                                                Text {
                                                    horizontal-alignment: center;
                                                    text: "Total";
                                                    color: Theme.onBackground;
                                                    font-size: Theme.fontSizeBody;
                                                    font-weight: 700;
                                                }
    
                                                Text {
                                                    horizontal-alignment: center;
                                                    text: "R$\{root.selected_client.preco}";
                                                    color: Theme.onBackground;
                                                    font-size: Theme.fontSizeBody;
                                                    font-weight: 500;
                                                }
                                            }
                                        }
    
                                        Container {
                                            cor: Theme.background;
                                            VerticalBox {
                                                Text {
                                                    text: "Observações:";
                                                    color: Theme.onBackground;
                                                    font-size: Theme.fontSizeBody;
                                                    font-weight: 700;
                                                }
    
                                                Text {
                                                    text: "\{root.selected_client.observacao}";
                                                    color: Theme.onBackground;
                                                    font-size: Theme.fontSizeBody;
                                                    font-weight: 500;
                                                }
                                            }
                                        }
    
                                        Container {
                                            cor: Theme.background;
                                            VerticalBox {
                                               VerticalBox {
                                                 Text {
                                                    text: "Envio";
                                                    color: Theme.onBackground;
                                                    font-size: Theme.fontSizeBody;
                                                    font-weight: 800;
                                                }
    
                                               }
                                               VerticalBox {
                                                 Text {
                                                    text: "Endereço";
                                                    color: Theme.onBackground;
                                                    font-size: Theme.fontSizeBody;
                                                    font-weight: 700;
                                                }
    
                                                Text {
                                                    text: "\{root.selected_client.endereco}";
                                                    color: Theme.onBackground;
                                                    font-size: Theme.fontSizeBody;
                                                    font-weight: 500;
                                                }

                                               }
                                               HorizontalBox {
                                                   VerticalBox {
                                                 Text {
                                                    text: "Cep";
                                                    color: Theme.onBackground;
                                                    font-size: Theme.fontSizeBody;
                                                    font-weight: 700;
                                                }
    
                                                Text {
                                                    text: "\{root.selected_client.cep}";
                                                    color: Theme.onBackground;
                                                    font-size: Theme.fontSizeBody;
                                                    font-weight: 500;
                                                }
                                               }
                                               VerticalBox {
                                                        
                                                        Text {
                                                            
                                                            text: "Data de Entrega";
                                                            color: Theme.onBackground;
                                                            font-size: Theme.fontSizeBody;
                                                            font-weight: 700;
                                                        }
    
                                                        Text {
                                                            
                                                            text: "\{root.selected_client.entrega}";
                                                            color: Theme.onBackground;
                                                            font-size: Theme.fontSizeBody;
                                                            font-weight: 500;
                                                        }
                                            }
                                                
                                               }
                                            
                                               
                                            }
                                        }
                                    }
                                }
                            }
                        }
                         
                    }
                }
            }
           
        }
    }


    Novo_Pedido := VerticalBox {
        visible: false;
        alignment: center;
        HorizontalBox {
            alignment: center;
            GridBox {
                width: 90%;
                VerticalLayout {
                    Text {
                        text: "Novo Pedido";
                        color: Theme.onSurface;
                        font-weight: 800;
                        font-size: 40px;
                    }
                }

                Row {
                    GridBox {
                        width: 90%;
                        spacing: Theme.spacing;
                        padding: Theme.spacing;
                        Row {
                            Container {
                                width: 50%;
                                cor: Theme.surface;
                                VerticalBox {
                                    padding: Theme.spacing;
                                    Text {
                                        text: "Dados do Cliente";
                                        color: Theme.onSurface;
                                        font-weight: 800;
                                        font-size: 20px;
                                    }

                                    VerticalBox {
                                        alignment: start;
                                        padding: Theme.spacing;
                                        InputField {
                                            texto: "Nome Cliente";
                                            max_lenght: 30;
                                            input <=> root.nome_cliente;
                                        }
                                        InputField {
                                            texto: "Cpf";
                                            max_lenght: 47;
                                            input <=> root.cpf;
                                        }

                                        InputField {
                                            texto: "Telefone";
                                            max_lenght: 47;
                                            input <=> root.telefone;
                                        }

                                        
                                        
                                    }
                                }
                            }

                            Container {
                                width: 50%;
                                cor: Theme.surface;
                                VerticalBox {
                                    alignment: start;
                                    padding: Theme.spacing;
                                    Text {
                                        text: "Detalhes de Entrega";
                                        color: Theme.onSurface;
                                        font-weight: 800;
                                        font-size: 20px;
                                    }
                                    
                                    VerticalLayout {
                                        padding: Theme.spacing;
                                        InputField {
                                            texto: "Endereço";
                                            max_lenght: 47;
                                            input <=> root.endereco;
                                        }
                                        InputField {
                                            texto: "Cep";
                                            max_lenght: 47;
                                            input <=> root.cep;
                                        }
                                                 DataInput {
                                                    texto: "Data";
                                                    input <=> entrega;
                                                 }
                                        
                                        
  

                                        InputField {
                                            max_lenght: 47;
                                            texto: "Observação";
                                            input <=> root.observacao;
                                        }










                                    }
                                }
                            }
                        }

                        Row {
                            Container {
                                cor: Theme.surface;
                                VerticalBox {
                                    padding: Theme.spacing;
                                    Text {
                                        text: "Detalhes de Impressão"; 
                                        color: Theme.onSurface;
                                        font-weight: 800;
                                        font-size: 20px;
                                    }

                                    VerticalBox {
                                        
                                        alignment: start;
                                        InputField {
                                            max_lenght: 47;
                                            texto: "Modelo 3D";
                                            input <=> root.modelo;
                                        }

                                        InputField {
                                            max_lenght: 4;
                                            texto: "Tempo Estimado [H]";
                                            input <=> root.tempo;
                                            changed input => {
                                                root.calcular_preco();
                                            }
                                            type: number;
                                        }
                                        InputField {
                                            texto: "Gasto de Material [g]";
                                            max_lenght: 5;
                                            input <=> root.material;
                                            changed input => {
                                                root.calcular_preco();
                                            }
                                            type: number;
                                        }

                                         CustomComboBox {
                                                    texto: "Impressora";
                                                    model: impressoras_string;
                                                    current-value: "";
                                                    text-color: Theme.onSurface;
                                                    selected(current-value) => {
                                                        combobox_selected = current-value;
                                                        atualizar_f_preco();
                                                    
                                                        root.calcular_preco();
                                                    }
                                                }

                                        

                                        VerticalLayout {
                                            spacing: Theme.spacing;
                                        
                                            // width: 50%;
                                            height: 5%;
                                            // Rectangle{height: 90%;width: 100px;}
                                            VerticalBox {        
                                                 spacing: Theme.spacing;
                                            padding: Theme.spacing;
                                                width: 50%;                                               
                                                // height: 30px;
                                                HorizontalLayout {
                                                    spacing: Theme.spacing;
                                                    Rectangle { 
                                                        
                                                        background: black;
                                                            // width: 100px;
                                                            BaloButton {
                                                                width: 100%;
                                                            
                                                                texto: "Voltar";
                                                                
                                                                clicked => {
                                                                    Pedidos.visible = true;
                                                                    Novo_Pedido.visible = false;
                                                                    resetar_inputs();
                                                                }
                                                            }
                                                        }

                                                }
                                                
                                               
                                                
                                            }
                                        }

                                    }
                                    
                                }
                                
                            }

                            Container {
                                cor: Theme.surface;
                                VerticalBox {
                                    padding: Theme.spacing;
                                    Text {
                                        text: "Calculo de Custos";
                                        color: Theme.onSurface;
                                        font-weight: 800;
                                        font-size: 20px;
                                    }

                                    VerticalBox {
                                        padding: Theme.spacing;
                                        InputField {
                                            texto: "Preço do filamento/Kg [R$]";
                                            input <=> root.filamento;
                                            changed input => {
                                                root.calcular_preco();
                                            }
                                            type:decimal;
                                        }

                                        InputField {
                                            texto: "Taxa de Energia [R$]";
                                            input <=> root.energia;
                                            changed input => {
                                                root.calcular_preco();
                                            }
                                            type:decimal;
                                        }

                                        InputField {
                                            texto: "Lucro [%]";
                                            input <=> root.lucro;
                                            changed input => {
                                                root.calcular_preco();
                                            }
                                            type:number;
                                        }

                                        Text {
                                            vertical-alignment: bottom;
                                            text: "Total: R$ \{root.total.to-fixed(2)}";
                                            font-weight: 700;
                                            horizontal-alignment: center;
                                            font-size: 20px;
                                            color: Theme.primary;
                                        }

                                       
                                    }
                                    VerticalLayout {
                                        width: 10%;
                                        height: 10%;
                                        // Rectangle{height: 90%;width: 100px;}
                                        VerticalBox {
                                            // width: 50%;
                                            height: 20px;
                                            SideButton {
                                                texto: "Concluir";
                                                clicked => {
                                                    status = "Pendente";
                                                    atualizar_filamento();
                                                    registrar_cliente();
                                                    resetar_inputs();
                                                    Novo_Pedido.visible = false;
                                                    Pedidos.visible = true;
                                                }
                                            }
                                            
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }  
}
